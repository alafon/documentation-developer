<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7/themes/algolia-min.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="api/rest_api/rest_api_reference/favicon.ico">
    <title>Ibexa Documentation Search</title>
    <style>
        .left-panel {
            float: left;
            width: 150px;
        }
        .right-panel {
            margin-left: 160px;
        }
        .ais-InstantSearch {
            overflow: hidden;
            margin: 0 auto;
        }
    </style>
</head>

<body>
<div class="ais-InstantSearch">
    <h1>Ibexa Documentation Search</h1>

    <div class="left-panel">
        <h2>Versions</h2>
        <div id="version"></div>
    </div>

    <div class="right-panel">
        <div id="searchbox" class="ais-SearchBox"></div>
        <div id="hits"></div>
        <div id="pagination"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>

<script>
  const search = instantsearch({
    indexName: 'ezplatform',
    searchClient: algoliasearch('2DNYOU6YJZ', '21ce3e522455e18e7ee16cf7d66edb4b'),
    initialUiState: {
      ezplatform: {
        query: decodeURI(document.location.hash.replace('#', '').replace('+', ' ')),
        refinementList: { version: [document.location.href.split('/')[4]] },
        page: 1
      },
    },
  });

  search.addWidgets([
    instantsearch.widgets.searchBox({
      container: '#searchbox',
    }),

    instantsearch.widgets.hits({
      container: '#hits',
      transformItems(items) {
        let removedPattern = 'Â¶';
        for (let index=0; index<items.length; index++) {
          let item = items[index];
          for (let lvl=2; lvl<=6; lvl++) {
            if (null !== item.hierarchy['lvl'+lvl]) {
              items[index].hierarchy['lvl' + lvl] = item.hierarchy['lvl' + lvl].replace(removedPattern, '');
            }
            if ('undefined' !== typeof item._highlightResult.hierarchy['lvl'+lvl]) {
              items[index]._highlightResult.hierarchy['lvl'+lvl].value = item._highlightResult.hierarchy['lvl'+lvl].value.replace(removedPattern, '');
            }
          }
        }
        return items;
      },
      templates: {
        item: `
        <div>
          <div><a href="{{url}}">{{#helpers.highlight}}{ "attribute": "hierarchy.lvl1", "highlightedTagName": "strong" }{{/helpers.highlight}}</a></div>
          <div>{{#helpers.highlight}}{ "attribute": "hierarchy.lvl2", "highlightedTagName": "strong" }{{/helpers.highlight}}</div>
          <div><small>{{#helpers.highlight}}{ "attribute": "hierarchy.lvl3", "highlightedTagName": "strong" }{{/helpers.highlight}}</smaller></div>
          <div><small>{{#helpers.highlight}}{ "attribute": "hierarchy.lvl4", "highlightedTagName": "strong" }{{/helpers.highlight}}</smaller></div>
          <div><small>{{#helpers.highlight}}{ "attribute": "hierarchy.lvl5", "highlightedTagName": "strong" }{{/helpers.highlight}}</smaller></div>
          <div><small>{{#helpers.highlight}}{ "attribute": "hierarchy.lvl6", "highlightedTagName": "strong" }{{/helpers.highlight}}</smaller></div>
        </div>
      ` ,
      },
    }),

    instantsearch.widgets.refinementList({
      container: document.querySelector('#version'),
      attribute: 'version',
      sortBy: ['name:desc'],
    }),

    instantsearch.widgets.pagination({
      container: '#pagination',
    }),
  ]);

  search.start();
</script>

</body>
</html>

<!--
https://www.algolia.com/doc/api-reference/api-parameters/filters/#examples
https://www.algolia.com/doc/api-reference/api-methods/multiple-queries/#method-param-indexname
https://www.algolia.com/doc/guides/managing-results/refine-results/filtering/
https://codesandbox.io/s/github/algolia/doc-code-samples/tree/master/instantsearch.js/getting-started
-->
